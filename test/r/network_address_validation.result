INSTALL EXTENSION vsql_network_address;
DROP TABLE IF EXISTS test_network_validation;
CREATE TABLE test_network_validation (
id INT PRIMARY KEY,
cidr_col CIDR,
inet_col INET,
mac_col MACADDR,
mac8_col MACADDR8
);
# Valid CIDR networks
INSERT INTO test_network_validation (id, cidr_col) VALUES (1, cidr_from_string('192.168.1.0/24'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (2, cidr_from_string('10.0.0.0/8'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (3, cidr_from_string('172.16.0.0/16'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (4, cidr_from_string('0.0.0.0/0'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (5, cidr_from_string('192.168.1.128/25'));
SELECT id, cidr_to_string(cidr_col) AS cidr_col FROM test_network_validation WHERE cidr_col IS NOT NULL ORDER BY id;
id	cidr_col
1	192.168.1.0/24
2	10.0.0.0/8
3	172.16.0.0/16
4	0.0.0.0/0
5	192.168.1.128/25
# Valid INET addresses (with and without netmask)
INSERT INTO test_network_validation (id, inet_col) VALUES (10, inet_from_string('192.168.1.1'));
INSERT INTO test_network_validation (id, inet_col) VALUES (11, inet_from_string('192.168.1.1/24'));
INSERT INTO test_network_validation (id, inet_col) VALUES (12, inet_from_string('10.0.0.1/8'));
INSERT INTO test_network_validation (id, inet_col) VALUES (13, inet_from_string('172.16.1.100/16'));
INSERT INTO test_network_validation (id, inet_col) VALUES (14, inet_from_string('203.0.113.50/24'));
SELECT id, inet_to_string(inet_col) AS inet_col FROM test_network_validation WHERE inet_col IS NOT NULL ORDER BY id;
id	inet_col
10	192.168.1.1
11	192.168.1.1/24
12	10.0.0.1/8
13	172.16.1.100/16
14	203.0.113.50/24
# Valid MAC addresses
INSERT INTO test_network_validation (id, mac_col) VALUES (20, macaddr_from_string('08:00:2b:01:02:03'));
INSERT INTO test_network_validation (id, mac_col) VALUES (21, macaddr_from_string('00:1b:44:11:3a:b7'));
INSERT INTO test_network_validation (id, mac_col) VALUES (22, macaddr_from_string('aa:bb:cc:dd:ee:ff'));
INSERT INTO test_network_validation (id, mac_col) VALUES (23, macaddr_from_string('00:00:00:00:00:00'));
INSERT INTO test_network_validation (id, mac_col) VALUES (24, macaddr_from_string('ff:ff:ff:ff:ff:ff'));
SELECT id, macaddr_to_string(mac_col) AS mac_col FROM test_network_validation WHERE mac_col IS NOT NULL ORDER BY id;
id	mac_col
20	08:00:2b:01:02:03
21	00:1b:44:11:3a:b7
22	aa:bb:cc:dd:ee:ff
23	00:00:00:00:00:00
24	ff:ff:ff:ff:ff:ff
# Valid MACADDR8 addresses
INSERT INTO test_network_validation (id, mac8_col) VALUES (30, macaddr8_from_string('08:00:2b:01:02:03:04:05'));
INSERT INTO test_network_validation (id, mac8_col) VALUES (31, macaddr8_from_string('00:1b:44:11:3a:b7:c8:d9'));
INSERT INTO test_network_validation (id, mac8_col) VALUES (32, macaddr8_from_string('aa:bb:cc:dd:ee:ff:11:22'));
INSERT INTO test_network_validation (id, mac8_col) VALUES (33, macaddr8_from_string('00:00:00:00:00:00:00:00'));
INSERT INTO test_network_validation (id, mac8_col) VALUES (34, macaddr8_from_string('ff:ff:ff:ff:ff:ff:ff:ff'));
SELECT id, macaddr8_to_string(mac8_col) AS mac8_col FROM test_network_validation WHERE mac8_col IS NOT NULL ORDER BY id;
id	mac8_col
30	08:00:2b:01:02:03:04:05
31	00:1b:44:11:3a:b7:c8:d9
32	aa:bb:cc:dd:ee:ff:11:22
33	00:00:00:00:00:00:00:00
34	ff:ff:ff:ff:ff:ff:ff:ff
# Hyphen and Cisco style MACADDR inputs normalize correctly
INSERT INTO test_network_validation (id, mac_col) VALUES
(40, macaddr_from_string('08-00-2b-01-02-03')),
(41, macaddr_from_string('08002b:010203'));
INSERT INTO test_network_validation (id, mac8_col) VALUES
(42, macaddr8_from_string('08-00-2b-01-02-03-04-05')),
(43, macaddr8_from_string('08002b:0102030405'));
SELECT id, macaddr_to_string(mac_col) AS mac_col FROM test_network_validation WHERE id BETWEEN 40 AND 41 ORDER BY id;
id	mac_col
40	08:00:2b:01:02:03
41	08:00:2b:01:02:03
SELECT id, macaddr8_to_string(mac8_col) AS mac8_col FROM test_network_validation WHERE id BETWEEN 42 AND 43 ORDER BY id;
id	mac8_col
42	08:00:2b:01:02:03:04:05
43	08:00:2b:01:02:03:04:05
# CIDR rejects host bits and out-of-range prefixes (returns NULL)
SELECT cidr_from_string('192.168.1.5/24') IS NULL AS cidr_host_bits_null;
cidr_host_bits_null
0
SELECT cidr_from_string('10.0.0.0/40') IS NULL AS cidr_mask_out_of_range;
cidr_mask_out_of_range
0
# INET rejects bogus masks (returns NULL)
SELECT inet_from_string('10.0.0.1/64') IS NULL AS inet_mask_out_of_range;
inet_mask_out_of_range
0
# MACADDR variants still raise when hex is incomplete
SELECT macaddr_from_string('08:00:2b:01:02') IS NULL AS macaddr_incomplete;
macaddr_incomplete
0
# IPv6 should now be supported
SELECT inet_from_string('2001:db8:0000:0000:0000:0000:0000:0001/64') IS NOT NULL AS inet_ipv6_supported;
inet_ipv6_supported
1
SELECT cidr_from_string('2001:0db8:0000:0000:0000:0000:0000:0000/48') IS NOT NULL AS cidr_ipv6_supported;
cidr_ipv6_supported
1
# Valid IPv6 CIDR networks
INSERT INTO test_network_validation (id, cidr_col) VALUES (50, cidr_from_string('2001:0db8:0000:0000:0000:0000:0000:0000/32'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (51, cidr_from_string('2001:0db8:85a3:0000:0000:0000:0000:0000/48'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (52, cidr_from_string('fe80:0000:0000:0000:0000:0000:0000:0000/64'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (53, cidr_from_string('0000:0000:0000:0000:0000:0000:0000:0000/0'));
SELECT id, cidr_to_string(cidr_col) AS cidr_col FROM test_network_validation WHERE id BETWEEN 50 AND 53 ORDER BY id;
id	cidr_col
50	2001:0db8:0000:0000:0000:0000:0000:0000/32
51	2001:0db8:85a3:0000:0000:0000:0000:0000/48
52	fe80:0000:0000:0000:0000:0000:0000:0000/64
53	0000:0000:0000:0000:0000:0000:0000:0000/0
# Valid IPv6 INET addresses (with and without netmask)
INSERT INTO test_network_validation (id, inet_col) VALUES (60, inet_from_string('2001:0db8:0000:0000:0000:0000:0000:0001'));
INSERT INTO test_network_validation (id, inet_col) VALUES (61, inet_from_string('2001:0db8:0000:0000:0000:0000:0000:0001/64'));
INSERT INTO test_network_validation (id, inet_col) VALUES (62, inet_from_string('fe80:0000:0000:0000:0204:61ff:fe9d:f156/64'));
INSERT INTO test_network_validation (id, inet_col) VALUES (63, inet_from_string('0000:0000:0000:0000:0000:0000:0000:0001'));
SELECT id, inet_to_string(inet_col) AS inet_col FROM test_network_validation WHERE id BETWEEN 60 AND 63 ORDER BY id;
id	inet_col
60	2001:0db8:0000:0000:0000:0000:0000:0001
61	2001:0db8:0000:0000:0000:0000:0000:0001/64
62	fe80:0000:0000:0000:0204:61ff:fe9d:f156/64
63	0000:0000:0000:0000:0000:0000:0000:0001
# IPv6 compressed notation with ::
INSERT INTO test_network_validation (id, inet_col) VALUES (70, inet_from_string('2001:db8::1'));
INSERT INTO test_network_validation (id, inet_col) VALUES (71, inet_from_string('::1'));
INSERT INTO test_network_validation (id, inet_col) VALUES (72, inet_from_string('::'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (73, cidr_from_string('2001:db8::/32'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (74, cidr_from_string('fe80::/64'));
SELECT id,
cidr_to_string(cidr_col) AS cidr_col,
inet_to_string(inet_col) AS inet_col
FROM test_network_validation WHERE id BETWEEN 70 AND 74 ORDER BY id;
id	cidr_col	inet_col
70	NULL	2001:0db8:0000:0000:0000:0000:0000:0001
71	NULL	0000:0000:0000:0000:0000:0000:0000:0001
72	NULL	0000:0000:0000:0000:0000:0000:0000:0000
73	2001:0db8:0000:0000:0000:0000:0000:0000/32	NULL
74	fe80:0000:0000:0000:0000:0000:0000:0000/64	NULL
# Test boundary conditions
INSERT INTO test_network_validation (id, cidr_col) VALUES (200, cidr_from_string('0.0.0.0/0'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (201, cidr_from_string('192.168.1.255/32'));
INSERT INTO test_network_validation (id, inet_col) VALUES (210, inet_from_string('0.0.0.0'));
INSERT INTO test_network_validation (id, inet_col) VALUES (211, inet_from_string('255.255.255.255'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (212, cidr_from_string('::/0'));
INSERT INTO test_network_validation (id, cidr_col) VALUES (213, cidr_from_string('ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff/128'));
INSERT INTO test_network_validation (id, mac_col, mac8_col) VALUES
(220, macaddr_from_string('00:00:00:00:00:00'), macaddr8_from_string('00:00:00:00:00:00:00:00'));
SELECT id,
cidr_to_string(cidr_col) AS cidr_col,
inet_to_string(inet_col) AS inet_col,
macaddr_to_string(mac_col) AS mac_col,
macaddr8_to_string(mac8_col) AS mac8_col
FROM test_network_validation WHERE id >= 200 ORDER BY id;
id	cidr_col	inet_col	mac_col	mac8_col
200	0.0.0.0/0	NULL	NULL	NULL
201	192.168.1.255/32	NULL	NULL	NULL
210	NULL	0.0.0.0	NULL	NULL
211	NULL	255.255.255.255	NULL	NULL
212	0000:0000:0000:0000:0000:0000:0000:0000/0	NULL	NULL	NULL
213	ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff/128	NULL	NULL	NULL
220	NULL	NULL	00:00:00:00:00:00	00:00:00:00:00:00:00:00
# Verify data was inserted for boundary conditions
SELECT COUNT(*) as boundary_records FROM test_network_validation WHERE id >= 200;
boundary_records
7
DROP TABLE test_network_validation;
UNINSTALL EXTENSION vsql_network_address;
