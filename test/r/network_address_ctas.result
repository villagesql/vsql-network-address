INSTALL EXTENSION vsql_network_address;
DROP TABLE IF EXISTS source_table, ctas_basic, ctas_filtered, ctas_computed,
ctas_joined, ctas_grouped, ctas_mixed;
CREATE TABLE source_table (
id INT AUTO_INCREMENT PRIMARY KEY,
network CIDR,
address INET NOT NULL,
mac MACADDR,
mac8 MACADDR8
);
INSERT INTO source_table (network, address, mac, mac8)
VALUES
(vsql_network_address.cidr_from_string('192.168.1.0/24'), vsql_network_address.inet_from_string('192.168.1.5'),
vsql_network_address.macaddr_from_string('08:00:2b:01:02:03'), vsql_network_address.macaddr8_from_string('08:00:2b:01:02:03:04:05')),
(vsql_network_address.cidr_from_string('10.0.0.0/8'), vsql_network_address.inet_from_string('10.0.0.1'),
vsql_network_address.macaddr_from_string('aa:bb:cc:dd:ee:ff'), vsql_network_address.macaddr8_from_string('aa:bb:cc:dd:ee:ff:00:11')),
(vsql_network_address.cidr_from_string('172.16.0.0/16'), vsql_network_address.inet_from_string('172.16.1.10'),
vsql_network_address.macaddr_from_string('11:22:33:44:55:66'), vsql_network_address.macaddr8_from_string('11:22:33:44:55:66:77:88')),
(vsql_network_address.cidr_from_string('2001:db8::/32'), vsql_network_address.inet_from_string('2001:db8::1/64'),
vsql_network_address.macaddr_from_string('00:11:22:33:44:55'), vsql_network_address.macaddr8_from_string('00:11:22:33:44:55:66:77'));
CREATE TABLE ctas_basic
SELECT * FROM source_table;
SHOW FULL COLUMNS FROM ctas_basic;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
id	int	NULL	NO		0		select,insert,update,references	
network	vsql_network_address.CIDR	NULL	YES		NULL		select,insert,update,references	
address	vsql_network_address.INET	NULL	NO		NULL		select,insert,update,references	
mac	vsql_network_address.MACADDR	NULL	YES		NULL		select,insert,update,references	
mac8	vsql_network_address.MACADDR8	NULL	YES		NULL		select,insert,update,references	
SELECT id, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address),
vsql_network_address.macaddr_to_string(mac), vsql_network_address.macaddr8_to_string(mac8)
FROM ctas_basic
ORDER BY id;
id	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)	vsql_network_address.macaddr_to_string(mac)	vsql_network_address.macaddr8_to_string(mac8)
1	192.168.1.0/24	192.168.1.5	08:00:2b:01:02:03	08:00:2b:01:02:03:04:05
2	10.0.0.0/8	10.0.0.1	aa:bb:cc:dd:ee:ff	aa:bb:cc:dd:ee:ff:00:11
3	172.16.0.0/16	172.16.1.10	11:22:33:44:55:66	11:22:33:44:55:66:77:88
4	2001:0db8:0000:0000:0000:0000:0000:0000/32	2001:0db8:0000:0000:0000:0000:0000:0001/64	00:11:22:33:44:55	00:11:22:33:44:55:66:77
INSERT INTO ctas_basic (id, network, address, mac, mac8)
VALUES
(4, vsql_network_address.cidr_from_string('192.168.2.0/24'), vsql_network_address.inet_from_string('192.168.2.1'),
vsql_network_address.macaddr_from_string('ff:ee:dd:cc:bb:aa'), vsql_network_address.macaddr8_from_string('ff:ee:dd:cc:bb:aa:99:88'));
SELECT id, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address),
vsql_network_address.macaddr_to_string(mac), vsql_network_address.macaddr8_to_string(mac8)
FROM ctas_basic
ORDER BY id;
id	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)	vsql_network_address.macaddr_to_string(mac)	vsql_network_address.macaddr8_to_string(mac8)
1	192.168.1.0/24	192.168.1.5	08:00:2b:01:02:03	08:00:2b:01:02:03:04:05
2	10.0.0.0/8	10.0.0.1	aa:bb:cc:dd:ee:ff	aa:bb:cc:dd:ee:ff:00:11
3	172.16.0.0/16	172.16.1.10	11:22:33:44:55:66	11:22:33:44:55:66:77:88
4	2001:0db8:0000:0000:0000:0000:0000:0000/32	2001:0db8:0000:0000:0000:0000:0000:0001/64	00:11:22:33:44:55	00:11:22:33:44:55:66:77
4	192.168.2.0/24	192.168.2.1	ff:ee:dd:cc:bb:aa	ff:ee:dd:cc:bb:aa:99:88
CREATE TABLE ctas_filtered
SELECT * FROM source_table
WHERE id <= 2;
SELECT id, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address),
vsql_network_address.macaddr_to_string(mac), vsql_network_address.macaddr8_to_string(mac8)
FROM ctas_filtered
ORDER BY id;
id	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)	vsql_network_address.macaddr_to_string(mac)	vsql_network_address.macaddr8_to_string(mac8)
1	192.168.1.0/24	192.168.1.5	08:00:2b:01:02:03	08:00:2b:01:02:03:04:05
2	10.0.0.0/8	10.0.0.1	aa:bb:cc:dd:ee:ff	aa:bb:cc:dd:ee:ff:00:11
CREATE TABLE ctas_selected_columns
SELECT id, network, address FROM source_table;
SHOW FULL COLUMNS FROM ctas_selected_columns;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
id	int	NULL	NO		0		select,insert,update,references	
network	vsql_network_address.CIDR	NULL	YES		NULL		select,insert,update,references	
address	vsql_network_address.INET	NULL	NO		NULL		select,insert,update,references	
SELECT id, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address)
FROM ctas_selected_columns
ORDER BY id;
id	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)
1	192.168.1.0/24	192.168.1.5
2	10.0.0.0/8	10.0.0.1
3	172.16.0.0/16	172.16.1.10
4	2001:0db8:0000:0000:0000:0000:0000:0000/32	2001:0db8:0000:0000:0000:0000:0000:0001/64
CREATE TABLE ctas_computed
SELECT
id,
network,
address,
CAST(vsql_network_address.inet_to_string(address) AS CHAR(50)) AS address_str,
CAST(vsql_network_address.macaddr_to_string(mac) AS CHAR(20)) AS mac_str
FROM source_table;
SHOW FULL COLUMNS FROM ctas_computed;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
id	int	NULL	NO		0		select,insert,update,references	
network	vsql_network_address.CIDR	NULL	YES		NULL		select,insert,update,references	
address	vsql_network_address.INET	NULL	NO		NULL		select,insert,update,references	
address_str	varchar(50)	utf8mb4_0900_ai_ci	YES		NULL		select,insert,update,references	
mac_str	varchar(20)	utf8mb4_0900_ai_ci	YES		NULL		select,insert,update,references	
SELECT id, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address), address_str, mac_str
FROM ctas_computed
ORDER BY id;
id	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)	address_str	mac_str
1	192.168.1.0/24	192.168.1.5	192.168.1.5	08:00:2b:01:02:03
2	10.0.0.0/8	10.0.0.1	10.0.0.1	aa:bb:cc:dd:ee:ff
3	172.16.0.0/16	172.16.1.10	172.16.1.10	11:22:33:44:55:66
4	2001:0db8:0000:0000:0000:0000:0000:0000/32	2001:0db8:0000:0000:0000:0000:0000:0001/64	2001:0db8:0000:0000:0000:0000:0000:0001/64	00:11:22:33:44:55
CREATE TABLE device_info (
device_id INT PRIMARY KEY,
device_name VARCHAR(100)
);
INSERT INTO device_info VALUES
(1, 'router-01'),
(2, 'switch-01'),
(3, 'firewall-01');
CREATE TABLE ctas_joined
SELECT
s.id,
d.device_name,
s.network,
s.address,
s.mac
FROM source_table s
INNER JOIN device_info d ON s.id = d.device_id;
SHOW FULL COLUMNS FROM ctas_joined;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
id	int	NULL	NO		0		select,insert,update,references	
device_name	varchar(100)	utf8mb4_0900_ai_ci	YES		NULL		select,insert,update,references	
network	vsql_network_address.CIDR	NULL	YES		NULL		select,insert,update,references	
address	vsql_network_address.INET	NULL	NO		NULL		select,insert,update,references	
mac	vsql_network_address.MACADDR	NULL	YES		NULL		select,insert,update,references	
SELECT id, device_name, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address),
vsql_network_address.macaddr_to_string(mac)
FROM ctas_joined
ORDER BY id;
id	device_name	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)	vsql_network_address.macaddr_to_string(mac)
1	router-01	192.168.1.0/24	192.168.1.5	08:00:2b:01:02:03
2	switch-01	10.0.0.0/8	10.0.0.1	aa:bb:cc:dd:ee:ff
3	firewall-01	172.16.0.0/16	172.16.1.10	11:22:33:44:55:66
CREATE TABLE device_networks (
device_type VARCHAR(50),
network CIDR,
address INET
);
INSERT INTO device_networks VALUES
('router', vsql_network_address.cidr_from_string('10.1.0.0/16'), vsql_network_address.inet_from_string('10.1.0.1')),
('router', vsql_network_address.cidr_from_string('10.2.0.0/16'), vsql_network_address.inet_from_string('10.2.0.1')),
('switch', vsql_network_address.cidr_from_string('10.3.0.0/16'), vsql_network_address.inet_from_string('10.3.0.1'));
CREATE TABLE ctas_grouped
SELECT
device_type,
COUNT(*) as device_count
FROM device_networks
GROUP BY device_type;
SHOW FULL COLUMNS FROM ctas_grouped;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
device_type	varchar(50)	utf8mb4_0900_ai_ci	YES		NULL		select,insert,update,references	
device_count	bigint	NULL	NO		0		select,insert,update,references	
SELECT device_type, device_count FROM ctas_grouped ORDER BY device_type;
device_type	device_count
router	2
switch	1
CREATE TABLE ctas_mixed
SELECT
id,
CONCAT('Device-', LPAD(id, 3, '0')) AS device_name,
network,
address,
NOW() AS created_at
FROM source_table;
SHOW FULL COLUMNS FROM ctas_mixed;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
id	int	NULL	NO		0		select,insert,update,references	
device_name	varchar(10)	utf8mb4_0900_ai_ci	YES		NULL		select,insert,update,references	
network	vsql_network_address.CIDR	NULL	YES		NULL		select,insert,update,references	
address	vsql_network_address.INET	NULL	NO		NULL		select,insert,update,references	
created_at	datetime	NULL	NO		NULL		select,insert,update,references	
SELECT id, device_name, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address)
FROM ctas_mixed
ORDER BY id;
id	device_name	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)
1	Device-001	192.168.1.0/24	192.168.1.5
2	Device-002	10.0.0.0/8	10.0.0.1
3	Device-003	172.16.0.0/16	172.16.1.10
4	Device-004	2001:0db8:0000:0000:0000:0000:0000:0000/32	2001:0db8:0000:0000:0000:0000:0000:0001/64
CREATE TABLE ctas_aliases
SELECT
id AS device_id,
network AS subnet,
address AS ip_address,
mac AS hw_address
FROM source_table
WHERE id = 1;
SHOW FULL COLUMNS FROM ctas_aliases;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
device_id	int	NULL	NO		0		select,insert,update,references	
subnet	vsql_network_address.CIDR	NULL	YES		NULL		select,insert,update,references	
ip_address	vsql_network_address.INET	NULL	NO		NULL		select,insert,update,references	
hw_address	vsql_network_address.MACADDR	NULL	YES		NULL		select,insert,update,references	
SELECT device_id, vsql_network_address.cidr_to_string(subnet), vsql_network_address.inet_to_string(ip_address),
vsql_network_address.macaddr_to_string(hw_address)
FROM ctas_aliases;
device_id	vsql_network_address.cidr_to_string(subnet)	vsql_network_address.inet_to_string(ip_address)	vsql_network_address.macaddr_to_string(hw_address)
1	192.168.1.0/24	192.168.1.5	08:00:2b:01:02:03
CREATE TABLE alternate_networks (
id INT,
network CIDR,
address INET
);
INSERT INTO alternate_networks VALUES
(100, vsql_network_address.cidr_from_string('192.168.100.0/24'), vsql_network_address.inet_from_string('192.168.100.1')),
(101, vsql_network_address.cidr_from_string('192.168.101.0/24'), vsql_network_address.inet_from_string('192.168.101.1'));
CREATE TABLE ctas_union
SELECT id, network, address FROM source_table
UNION
SELECT id, network, address FROM alternate_networks;
SHOW FULL COLUMNS FROM ctas_union;
Field	Type	Collation	Null	Key	Default	Extra	Privileges	Comment
id	int	NULL	YES		NULL		select,insert,update,references	
network	vsql_network_address.CIDR	NULL	YES		NULL		select,insert,update,references	
address	vsql_network_address.INET	NULL	YES		NULL		select,insert,update,references	
SELECT id, vsql_network_address.cidr_to_string(network), vsql_network_address.inet_to_string(address)
FROM ctas_union
ORDER BY id;
id	vsql_network_address.cidr_to_string(network)	vsql_network_address.inet_to_string(address)
1	192.168.1.0/24	192.168.1.5
2	10.0.0.0/8	10.0.0.1
3	172.16.0.0/16	172.16.1.10
4	2001:0db8:0000:0000:0000:0000:0000:0000/32	2001:0db8:0000:0000:0000:0000:0000:0001/64
100	192.168.100.0/24	192.168.100.1
101	192.168.101.0/24	192.168.101.1
DROP TABLE source_table, ctas_basic, ctas_filtered, ctas_selected_columns,
ctas_computed, device_info, ctas_joined, device_networks,
ctas_grouped, ctas_mixed, ctas_aliases, alternate_networks, ctas_union;
UNINSTALL EXTENSION vsql_network_address;
